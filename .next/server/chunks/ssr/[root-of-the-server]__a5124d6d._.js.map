{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/genkit.ts"],"sourcesContent":["import {genkit} from 'genkit';\nimport {googleAI} from '@genkit-ai/google-genai';\n\nexport const ai = genkit({\n  plugins: [googleAI()],\n  model: 'googleai/gemini-2.5-flash',\n});\n"],"names":[],"mappings":";;;AAAA;AAAA;AACA;AAAA;;;AAEO,MAAM,KAAK,CAAA,GAAA,uIAAA,CAAA,SAAM,AAAD,EAAE;IACvB,SAAS;QAAC,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD;KAAI;IACrB,OAAO;AACT","debugId":null}},
    {"offset": {"line": 292, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/flows/branching-narrative-system.ts"],"sourcesContent":["\n'use server';\n/**\n * @fileOverview This file defines the Genkit flow for the BranchingNarrativeSystem story.\n *\n * - generateNextScenario - A function that generates the next game scenario based on player context.\n * - NarrativeInput - The input type for the generateNextScenario function.\n * - NarrativeOutput - The return type for the generateNextScenario function.\n */\n\nimport {ai} from '@/ai/genkit';\nimport {z} from 'genkit';\n\nconst NarrativeInputSchema = z.object({\n  playerClass: z.string().describe('The class of the player character.'),\n  level: z.number().describe('The current level of the player.'),\n  location: z.string().describe('The current location in the game.'),\n  choices: z.array(z.object({\n    id: z.string().describe('The ID of the choice made.'),\n    text: z.string().describe('The text of the choice made.'),\n    tags: z.array(z.string()).describe('Tags associated with the choice (e.g., STEALTH, COMBAT, DIPLOMACY).'),\n  })).describe('The choices the player has made so far.'),\n  reputation: z.object({\n    stealth: z.number().describe('The player reputation for stealth.'),\n    combat: z.number().describe('The player reputation for combat.'),\n    diplomacy: z.number().describe('The player reputation for diplomacy.'),\n  }).describe('The player reputation.'),\n  unlockedPaths: z.array(z.string()).describe('The paths unlocked by the player.'),\n  questFlags: z.record(z.string(), z.object({\n    status: z.string().describe('The status of the quest (e.g., \"started\", \"completed\").'),\n    currentStep: z.number().describe('The current step the player is on for this quest.'),\n  })).describe('A map of quest IDs to their state and progress.'),\n});\nexport type NarrativeInput = z.infer<typeof NarrativeInputSchema>;\n\nconst NarrativeOutputSchema = z.object({\n  scenarioText: z.string().describe('The generated scenario text.'),\n  choices: z.array(z.object({\n    id: z.string().describe('A unique ID for the choice (e.g., \"A\", \"B\", \"C\").'),\n    text: z.string().describe('The text of the choice.'),\n    tags: z.array(z.string()).describe('An array of tags classifying the choice (e.g., COMBAT, DIPLOMACY, STEALTH, NPC_INTERACTION).'),\n    questProgress: z.object({\n        questId: z.string().describe('The ID of the quest this choice progresses.'),\n        nextStep: z.number().describe('The next step the quest will be set to.'),\n    }).optional().describe('If this choice progresses a quest, this object contains the details.'),\n    isQuestCompletion: z.boolean().optional().describe('Set to true if this choice completes the entire quest.'),\n  })).describe('The choices available to the player.'),\n});\nexport type NarrativeOutput = z.infer<typeof NarrativeOutputSchema>;\n\nexport async function generateNextScenario(input: NarrativeInput): Promise<NarrativeOutput> {\n  return branchingNarrativeFlow(input);\n}\n\nconst branchingNarrativePrompt = ai.definePrompt({\n  name: 'branchingNarrativePrompt',\n  input: {schema: NarrativeInputSchema},\n  output: {schema: NarrativeOutputSchema},\n  prompt: `You are the Fartmaster, the master storyteller for Poot Quest. Your purpose is to weave a multi-step, branching tale where success and chaos are logical consequences of the player's actions.\n\n  **The Fartmaster's Creed:**\n  1.  **The World Remembers:** Every adventure must feel uniquely personal. NPCs remember actions and \"scents\" (reputation).\n  2.  **Character is Fate:** Your narration must adapt the world based on the player's class, personality, and moral quirks.\n  3.  **Multi-Step Quests:** Quests are your priority. A quest has a status (\"started\", \"completed\") and a \"currentStep\". The scenario you generate MUST be appropriate for the current step of any active quest.\n\n  **Player Context Analysis:**\n  -   **Class:** {{playerClass}} (Level {{level}})\n  -   **Location:** {{location}}\n  -   **Reputation:** Stealth: {{reputation.stealth}}, Combat: {{reputation.combat}}, Diplomacy: {{reputation.diplomacy}}\n  -   **Past Choices:**\n      {{#each choices}}\n      - {{this.text}} ({{#each this.tags}}{{@key}}{{#if @last}}{{else}}, {{/if}}{{/each}})\n      {{/each}}\n  -   **Active Quests:** Your main priority is to generate a scenario for any quest with a \"started\" status in the questFlags object below. Pay close attention to the \"currentStep\".\n      \\`\\`\\`json\n      {{{json questFlags}}}\n      \\`\\`\\`\n  -   **Unlocked Story Paths:** {{unlockedPaths}}\n\n  **Your Task:**\n  Analyze all of the above context. Generate the next scenario and three distinct, compelling choices (A, B, C).\n  1.  **Reactive Scenario:** Write a scenario that is a direct consequence of the character's journey. **If a quest is \"started\", the scenario MUST correspond to its \"currentStep\".** For example, if \"rat_king_quest\" is on step 1, the player might be finding the sewer entrance. If it's on step 2, they might be confronting the Rat King himself. If there are no active quests, generate a scenario for the current location.\n  2.  **Quest-Driven Choices:** The choices you offer must drive the story forward.\n      -   **Quest Progression:** If a choice advances a quest to its next stage, it **MUST** include a \\`questProgress\\` object with the \\`questId\\` and the \\`nextStep\\`.\n      -   **Quest Completion:** If a choice completes the final step of a quest, it **MUST** set \\`isQuestCompletion\\` to \\`true\\`. Do not use \\`questProgress\\` for the final step.\n      -   **Character-Driven Options:** Offer choices that align with the character's class or highest reputation score.\n  3.  **Tag Your Choices:** Each choice must have at least one tag: \\`STEALTH\\`, \\`COMBAT\\`, \\`DIPLOMACY\\`, or \\`NPC_INTERACTION\\`.\n\n  **Example Quest: \"rat_king_quest\"**\n  -   **Step 1:** Player finds a clue about the Rat King's location. A choice to \"Follow the tracks\" should have \\`questProgress: { questId: \"rat_king_quest\", nextStep: 2 }\\`.\n  -   **Step 2:** Player confronts the Rat King (a COMBAT encounter). The choice to \"Attack the King!\" would not have a questProgress field, but the COMBAT tag would trigger the fight. After the fight, the game logic will advance the story.\n  -   **Step 3:** Player returns to the quest giver. The choice \"Here is the Rat King's crown\" should have \\`isQuestCompletion: true\\`.\n\n  The output MUST conform to the schema. Make the story a living reflection of the player's soul.`,\n});\n\nconst branchingNarrativeFlow = ai.defineFlow(\n  {\n    name: 'branchingNarrativeFlow',\n    inputSchema: NarrativeInputSchema,\n    outputSchema: NarrativeOutputSchema,\n  },\n  async input => {\n    const {output} = await branchingNarrativePrompt(input);\n    return output!;\n  }\n);\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 411, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/flows/flow-schemas.ts"],"sourcesContent":["import { z } from 'zod';\n\nexport const EncounterInputSchema = z.object({\n    playerClass: z.string().describe('The class of the player character.'),\n    playerLevel: z.number().describe('The current level of the player.'),\n    location: z.string().describe('The current location in the game.'),\n    questId: z.string().optional().describe('The ID of the active quest, if any.'),\n});\nexport type EncounterInput = z.infer<typeof EncounterInputSchema>;\n\nconst EnemySchema = z.object({\n    id: z.string().describe(\"A unique ID for this enemy instance, e.g., 'goblin-1'\"),\n    name: z.string().describe('The name of the enemy.'),\n    hp: z.number().describe('The health points of the enemy.'),\n    maxHp: z.number().describe('The maximum health points of the enemy.'),\n    imageUrl: z.string().describe('A public URL for an image of the enemy. Use a placeholder from picsum.photos.'),\n    attack: z.number().describe('The base attack power of the enemy.'),\n});\n\nconst LootSchema = z.object({\n    name: z.string().describe('The name of the loot item.'),\n    description: z.string().describe('A description of the loot item.'),\n    type: z.enum([\"weapon\", \"armor\", \"potion\", \"scroll\", \"misc\"]).describe('The type of the item.'),\n});\n\nexport const EncounterOutputSchema = z.object({\n    enemies: z.array(EnemySchema).describe('An array of enemies for the player to fight.'),\n    loot: LootSchema.describe('The loot awarded for winning the encounter.'),\n    introText: z.string().describe('A short, flavorful introductory text for the encounter.'),\n});\nexport type EncounterOutput = z.infer<typeof EncounterOutputSchema>;\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,uBAAuB,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACzC,aAAa,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IACjC,aAAa,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IACjC,UAAU,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC9B,SAAS,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;AAC5C;AAGA,MAAM,cAAc,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACzB,IAAI,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IACxB,MAAM,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,IAAI,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IACxB,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC3B,UAAU,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC9B,QAAQ,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;AAChC;AAEA,MAAM,aAAa,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACxB,MAAM,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,aAAa,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IACjC,MAAM,oIAAA,CAAA,IAAC,CAAC,IAAI,CAAC;QAAC;QAAU;QAAS;QAAU;QAAU;KAAO,EAAE,QAAQ,CAAC;AAC3E;AAEO,MAAM,wBAAwB,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC1C,SAAS,oIAAA,CAAA,IAAC,CAAC,KAAK,CAAC,aAAa,QAAQ,CAAC;IACvC,MAAM,WAAW,QAAQ,CAAC;IAC1B,WAAW,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;AACnC","debugId":null}},
    {"offset": {"line": 453, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/flows/generate-encounter-flow.ts"],"sourcesContent":["\n'use server';\n/**\n * @fileOverview This file defines the Genkit flow for generating combat encounters.\n *\n * - generateEncounter - A function that creates enemies and loot.\n */\n\nimport { ai } from '@/ai/genkit';\nimport { EncounterInputSchema, EncounterOutputSchema, type EncounterOutput, type EncounterInput } from './flow-schemas';\n\n\nexport async function generateEncounter(input: EncounterInput): Promise<EncounterOutput> {\n    return generateEncounterFlow(input);\n}\n\nconst generateEncounterPrompt = ai.definePrompt({\n    name: 'generateEncounterPrompt',\n    input: { schema: EncounterInputSchema },\n    output: { schema: EncounterOutputSchema },\n    prompt: `You are the AI Dungeon Master for Poot Quest. Your task is to generate a challenging but fair combat encounter for the player. The encounter should be creative and thematically linked to the player's context.\n\n  **Player Information:**\n  - Class: {{playerClass}}\n  - Level: {{playerLevel}}\n  - Location: {{location}}\n  - Active Quest: {{questId}}\n\n  **Your Task:**\n  Based on this information, generate an encounter with the following properties:\n  1.  **Enemies**: Create a group of 1 to 3 enemies. The enemies MUST be thematically appropriate for the location and the current quest. Be creative! A 'sewer' could have a 'Gelatinous Cube of Forgotten Leftovers', not just a goblin. If it's a quest-related battle (e.g., 'rat_king_quest'), one enemy MUST be the main boss (e.g., 'The Rat King'). Each enemy needs a unique ID.\n  2.  **Loot**: Generate one piece of loot that the player will receive if they win. The loot should be useful, interesting, and thematically tied to the enemies or location.\n  3.  **Intro Text**: Write a short, engaging introductory text (1-2 sentences) to set the scene for the battle.\n\n  **Example for a 'rat_king_quest' in a 'sewer':**\n  {\n    \"enemies\": [\n      {\n        \"id\": \"rat-king-boss\",\n        \"name\": \"The Rat King\",\n        \"hp\": 40,\n        \"maxHp\": 40,\n        \"imageUrl\": \"https://picsum.photos/seed/rat-king/150/150\",\n        \"attack\": 8\n      },\n      {\n        \"id\": \"rabid-rat-1\",\n        \"name\": \"Rabid Rat\",\n        \"hp\": 10,\n        \"maxHp\": 10,\n        \"imageUrl\": \"https://picsum.photos/seed/rabid-rat/100/100\",\n        \"attack\": 3\n      }\n    ],\n    \"loot\": {\n      \"name\": \"Crown of the Rat King\",\n      \"description\": \"A filthy, yet oddly majestic crown. Grants +1 to Diplomacy with rodents.\",\n      \"type\": \"misc\"\n    },\n    \"introText\": \"A monstrous amalgamation of rats, bound by a single will, rises from the filth. The Rat King screeches, its legion of eyes fixed on you!\"\n  }`,\n});\n\nconst generateEncounterFlow = ai.defineFlow(\n    {\n        name: 'generateEncounterFlow',\n        inputSchema: EncounterInputSchema,\n        outputSchema: EncounterOutputSchema,\n    },\n    async (input) => {\n        const { output } = await generateEncounterPrompt(input);\n        return output!;\n    }\n);\n"],"names":[],"mappings":";;;;;AAEA;;;;CAIC,GAED;AACA;;;;;;AAGO,eAAe,kBAAkB,KAAqB;IACzD,OAAO,sBAAsB;AACjC;AAEA,MAAM,0BAA0B,mHAAA,CAAA,KAAE,CAAC,YAAY,CAAC;IAC5C,MAAM;IACN,OAAO;QAAE,QAAQ,qIAAA,CAAA,uBAAoB;IAAC;IACtC,QAAQ;QAAE,QAAQ,qIAAA,CAAA,wBAAqB;IAAC;IACxC,QAAQ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GAwCV,CAAC;AACJ;AAEA,MAAM,wBAAwB,mHAAA,CAAA,KAAE,CAAC,UAAU,CACvC;IACI,MAAM;IACN,aAAa,qIAAA,CAAA,uBAAoB;IACjC,cAAc,qIAAA,CAAA,wBAAqB;AACvC,GACA,OAAO;IACH,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,wBAAwB;IACjD,OAAO;AACX;;;IA5DkB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 541, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/flows/ai-dungeon-master-npc.ts"],"sourcesContent":["\n'use server';\n/**\n * @fileOverview An AI agent for generating NPCs within the game dungeon.\n *\n * - generateNpc - A function that generates an NPC based on the player's context.\n * - NpcInput - The input type for the generateNpc function.\n * - NpcOutput - The return type for the generateNpc function.\n */\n\nimport {ai} from '@/ai/genkit';\nimport {z} from 'genkit';\n\nconst NpcInputSchema = z.object({\n  location: z.string().describe('The current location of the player in the dungeon.'),\n  playerClass: z.string().describe('The class of the player character.'),\n  playerContext: z.object({\n    level: z.number().describe('The current level of the player.'),\n    choices: z.array(z.object({\n      id: z.string(),\n      text: z.string(),\n      tags: z.array(z.string())\n    })).describe('The choices the player has made so far.'),\n    reputation: z.object({\n      stealth: z.number(),\n      combat: z.number(),\n      diplomacy: z.number()\n    }).describe('The player reputation scores.'),\n    questFlags: z.record(z.string(), z.object({\n        status: z.string(),\n        currentStep: z.number(),\n    })).describe('Flags indicating the status of various quests.')\n  }).describe('The player context, including level, choices, reputation, and quest flags.')\n});\n\nexport type NpcInput = z.infer<typeof NpcInputSchema>;\n\nconst NpcOutputSchema = z.object({\n  name: z.string().describe('The name of the NPC.'),\n  dialogue: z.string().describe('The dialogue the NPC speaks.'),\n  quest: z.string().optional().describe('A simple, actionable quest the NPC offers (e.g., \"Clear out the Rat King in the cellar\").'),\n  questId: z.string().optional().describe('A simple, machine-readable ID for the quest (e.g., \"rat_king_quest\").'),\n  reputationCheck: z.object({\n      stat: z.enum(['stealth', 'combat', 'diplomacy']),\n      threshold: z.number(),\n  }).optional().describe('If this quest requires a certain reputation, specify it here.'),\n  reward: z.string().optional().describe('The reward for completing the quest, if any.')\n});\n\nexport type NpcOutput = z.infer<typeof NpcOutputSchema>;\n\nexport async function generateNpc(input: NpcInput): Promise<NpcOutput> {\n  return generateNpcFlow(input);\n}\n\nconst generateNpcPrompt = ai.definePrompt({\n  name: 'generateNpcPrompt',\n  input: {schema: NpcInputSchema},\n  output: {schema: NpcOutputSchema},\n  prompt: `You are the AI Dungeon Master for Poot Quest. Your job is to create a living, breathing NPC that feels like a real part of the world.\n\n  **Player Context:**\n  - Class: {{playerClass}}\n  - Level: {{playerContext.level}}\n  - Location: {{location}}\n  - Reputation: Stealth: {{playerContext.reputation.stealth}}, Combat: {{playerContext.reputation.combat}}, Diplomacy: {{playerContext.reputation.diplomacy}}\n  - Known for: {{#each playerContext.choices}}- {{this.text}} {{/each}}\n  - Active Quests: {{#each playerContext.questFlags}} {{this}} {{/each}}\n\n  **Your Task:**\n  Create an NPC that is a direct reflection of the world and the player's journey.\n  1.  **Personality:** Give them a distinct personality that fits the {{location}}.\n  2.  **Reactive Dialogue:** The NPC's dialogue **must** reflect the player's reputation and past actions. They should not be generic. If combat reputation is high, they might be fearful, aggressive, or admiring. If diplomacy is high, they might be trusting or manipulative. They might even mention a specific past deed.\n  3.  **Quest Generation:** The NPC should offer a simple, actionable quest that makes sense for the location, their personality, and the player's class. The quest MUST have a simple, snake_case 'questId'. The quest should be a multi-step quest.\n  4.  **Reputation-Gated Quests:** Occasionally, create a quest that requires a minimum reputation score to accept. For example, a sneaky quest might require 50 stealth points. If you create such a quest, set the \\`reputationCheck\\` field.\n\n  **Example (for a player with high Combat reputation who recently cleared a goblin camp):**\n  - Name: \"Grizelda the Grim\"\n  - Dialogue: \"Easy there, killer. I saw what you did to Gassy's goons at the camp. I want no trouble. State your business and be on your way.\"\n  - Quest: \"If you're so tough, maybe you can clear out the Rat King deeper in. There's a rusty key in it for you.\"\n  - questId: \"clear_rat_king\"\n  - Reward: \"A Rusty Key\"\n\n  **Example (Reputation-Gated Quest):**\n  - Name: \"Whispering Willow\"\n  - Dialogue: \"I've heard whispers of your silent deeds. Not many can move through these shadows as you do.\"\n  - Quest: \"The Shadow Syndicate has a new ledger in their safehouse. I need a ghost to acquire it. This is not a job for a clumsy oaf.\"\n  - questId: \"shadow_ledger_heist\"\n  - reputationCheck: { \"stat\": \"stealth\", \"threshold\": 50 }\n  - Reward: \"A set of masterwork lockpicks\"\n\n  Return the NPC in the specified JSON format. If you offer a quest, you MUST provide a questId.`\n});\n\nconst generateNpcFlow = ai.defineFlow(\n  {\n    name: 'generateNpcFlow',\n    inputSchema: NpcInputSchema,\n    outputSchema: NpcOutputSchema,\n  },\n  async input => {\n    const {output} = await generateNpcPrompt(input);\n    return output!;\n  }\n);\n\n    "],"names":[],"mappings":";;;;;AAEA;;;;;;CAMC,GAED;AACA;AAAA;;;;;;AAEA,MAAM,iBAAiB,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC9B,UAAU,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC9B,aAAa,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IACjC,eAAe,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;QACtB,OAAO,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;QAC3B,SAAS,uIAAA,CAAA,IAAC,CAAC,KAAK,CAAC,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;YACxB,IAAI,uIAAA,CAAA,IAAC,CAAC,MAAM;YACZ,MAAM,uIAAA,CAAA,IAAC,CAAC,MAAM;YACd,MAAM,uIAAA,CAAA,IAAC,CAAC,KAAK,CAAC,uIAAA,CAAA,IAAC,CAAC,MAAM;QACxB,IAAI,QAAQ,CAAC;QACb,YAAY,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;YACnB,SAAS,uIAAA,CAAA,IAAC,CAAC,MAAM;YACjB,QAAQ,uIAAA,CAAA,IAAC,CAAC,MAAM;YAChB,WAAW,uIAAA,CAAA,IAAC,CAAC,MAAM;QACrB,GAAG,QAAQ,CAAC;QACZ,YAAY,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC,uIAAA,CAAA,IAAC,CAAC,MAAM,IAAI,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;YACtC,QAAQ,uIAAA,CAAA,IAAC,CAAC,MAAM;YAChB,aAAa,uIAAA,CAAA,IAAC,CAAC,MAAM;QACzB,IAAI,QAAQ,CAAC;IACf,GAAG,QAAQ,CAAC;AACd;AAIA,MAAM,kBAAkB,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC/B,MAAM,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,UAAU,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC9B,OAAO,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACtC,SAAS,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACxC,iBAAiB,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;QACtB,MAAM,uIAAA,CAAA,IAAC,CAAC,IAAI,CAAC;YAAC;YAAW;YAAU;SAAY;QAC/C,WAAW,uIAAA,CAAA,IAAC,CAAC,MAAM;IACvB,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACvB,QAAQ,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;AACzC;AAIO,eAAe,YAAY,KAAe;IAC/C,OAAO,gBAAgB;AACzB;AAEA,MAAM,oBAAoB,mHAAA,CAAA,KAAE,CAAC,YAAY,CAAC;IACxC,MAAM;IACN,OAAO;QAAC,QAAQ;IAAc;IAC9B,QAAQ;QAAC,QAAQ;IAAe;IAChC,QAAQ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;gGAgCqF,CAAC;AACjG;AAEA,MAAM,kBAAkB,mHAAA,CAAA,KAAE,CAAC,UAAU,CACnC;IACE,MAAM;IACN,aAAa;IACb,cAAc;AAChB,GACA,OAAM;IACJ,MAAM,EAAC,MAAM,EAAC,GAAG,MAAM,kBAAkB;IACzC,OAAO;AACT;;;IApDoB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 660, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/adventure/%5Bclass%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {generateNextScenario as '4011378f80c37ba99068f177bd7b0eecf62137152f'} from 'ACTIONS_MODULE0'\nexport {generateEncounter as '406f825516d0ff63673568bbefb64c469386655af9'} from 'ACTIONS_MODULE1'\nexport {generateNpc as '40d6521b635685790e625cdc513bc709fe4fd56730'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":";AAAA;AACA;AACA","debugId":null}},
    {"offset": {"line": 730, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/game/AdventureClient.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport const AdventureClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call AdventureClient() from the server but AdventureClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/game/AdventureClient.tsx <module evaluation>\",\n    \"AdventureClient\",\n);\n"],"names":[],"mappings":";;;AAAA;;AACO,MAAM,kBAAkB,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjD;IAAa,MAAM,IAAI,MAAM;AAA8O,GAC3Q,yEACA","debugId":null}},
    {"offset": {"line": 744, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/game/AdventureClient.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport const AdventureClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call AdventureClient() from the server but AdventureClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/game/AdventureClient.tsx\",\n    \"AdventureClient\",\n);\n"],"names":[],"mappings":";;;AAAA;;AACO,MAAM,kBAAkB,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjD;IAAa,MAAM,IAAI,MAAM;AAA8O,GAC3Q,qDACA","debugId":null}},
    {"offset": {"line": 758, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 768, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/game/GameContainer.tsx"],"sourcesContent":["import { cn } from \"@/lib/utils\";\nimport type { ReactNode } from \"react\";\n\nexport function GameContainer({ children, className }: { children: ReactNode, className?: string }) {\n  return (\n    <div className={cn(\"container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8\", className)}>\n      {children}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;;;AAGO,SAAS,cAAc,EAAE,QAAQ,EAAE,SAAS,EAA+C;IAChG,qBACE,8OAAC;QAAI,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,yDAAyD;kBACzE;;;;;;AAGP","debugId":null}},
    {"offset": {"line": 791, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/adventure/%5Bclass%5D/page.tsx"],"sourcesContent":["import { AdventureClient } from \"@/components/game/AdventureClient\";\nimport { GameContainer } from \"@/components/game/GameContainer\";\nimport { Header } from \"@/components/game/Header\";\n\ntype Props = {\n  params: { class: string }; // 'class' is the characterId from the URL\n};\n\nexport default function AdventurePage({ params }: Props) {\n  const characterId = params.class;\n\n  return (\n    <>\n      <Header />\n      <main className=\"py-12\">\n        <GameContainer>\n          <AdventureClient characterId={characterId} />\n        </GameContainer>\n      </main>\n    </>\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;AAMe,SAAS,cAAc,EAAE,MAAM,EAAS;IACrD,MAAM,cAAc,OAAO,KAAK;IAEhC,qBACE;;0BACE,8OAAC,oIAAA,CAAA,SAAM;;;;;0BACP,8OAAC;gBAAK,WAAU;0BACd,cAAA,8OAAC,2IAAA,CAAA,gBAAa;8BACZ,cAAA,8OAAC,6IAAA,CAAA,kBAAe;wBAAC,aAAa;;;;;;;;;;;;;;;;;;AAKxC","debugId":null}}]
}